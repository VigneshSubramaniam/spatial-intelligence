(this["webpackJsonpspace-intelligence"]=this["webpackJsonpspace-intelligence"]||[]).push([[0],{18:function(e,t,n){e.exports=n.p+"static/media/ground_floor.c6faa9c1.png"},24:function(e,t,n){e.exports=n(44)},29:function(e,t,n){},30:function(e,t,n){},32:function(e,t,n){},44:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),s=n(10),r=n.n(s),i=(n(29),n(4)),c=n(5),l=n(7),u=n(6),p=n(8),d=(n(30),n(1)),h=n(11),f=n(3),m=n(18),b=n.n(m),x=n(2),g=n(19),v=n.n(g),k=(n(31),n(32),n(9));n(34),n(36);function w(){var e=Object(d.a)(["\n    z-index:1;\n    position:absolute;\n    top: 8px;\n    right: 8px;\n    padding: 8px 16px;\n    border-radius: 4px;\n    border: 1px solid #dadfe3;\n    box-shadow: 0 2px 4px 0 rgba(18,52,77,0.06), 0 2px 18px 0 rgba(18,52,77,0.16);\n    background-color: ",";\n    cursor:pointer;\n    color: ",";\n    font-weight: 600;\n    &:hover{\n        border: ",";\n    }\n    &:focus{\n        outline: none;\n    }\n"]);return w=function(){return e},e}function y(){var e=Object(d.a)(["\n    cursor: pointer;\n    position: absolute;\n    transform: ",";\n    background-color: ",";\n    border-radius: 2px;\n    border: ",";\n    width: ","px;\n    height: ","px;\n"]);return y=function(){return e},e}function E(){var e=Object(d.a)(["\n    cursor: pointer;\n    display: flex;\n    align-items:center;\n    background-color: #FFF;\n    border-radius: 4px;\n    ","\n"]);return E=function(){return e},e}function O(){var e=Object(d.a)(["\n    font-size: 18px;\t\n    font-weight: bold;\t\n    line-height: 21px;\n    color: #12344D;\n    padding-top: 20px;\n"]);return O=function(){return e},e}function j(){var e=Object(d.a)(["\n    width: 50%;\n    padding: 12px 17px;\n    line-height: 20px;\n    color: #12344D;\n    opacity: 0.6;\n    border-top: 1px solid #EBEEF0;\n    font-size: 13px;\t\n    font-weight: 600;\t\n    background: #F5f7f9;\n"]);return j=function(){return e},e}function A(){var e=Object(d.a)(["\n    width: 33.33%;\n    padding: 12px 17px;\n    line-height: 20px;\n    color: #12344D;\n    border-top: 1px solid #EBEEF0;\n    font-size: 14px;\n    font-weight: 500;\n"]);return A=function(){return e},e}function C(){var e=Object(d.a)(["\n    margin: 8px;\n    width: calc(100vw - 18px);\n    background: #FFF;\n    box-shadow: 0 2px 18px 0 rgba(18,52,77,0.16);\n    border: 1px solid #EBEEF0;\n    height: 300px;\n    overflow: scroll;\n    position: absolute;\n    bottom: 0;\n    border-radius: 4px;\n"]);return C=function(){return e},e}function F(){var e=Object(d.a)(["\n    color: #12344D;\t\n    font-size: 13px;\n    font-weight: 600;\t\n    line-height: 20px;\n"]);return F=function(){return e},e}function D(){var e=Object(d.a)(["\t\n    color: #12344D;\t\n    font-size: 13px;\t\n    line-height: 20px;\n"]);return D=function(){return e},e}function S(){var e=Object(d.a)(["\n    width: 1px;\n    opacity: 0.6;\t\n    color: #12344D;\t\n    font-size: 14px;\t\n    line-height: 16px;\t\n    text-align: center;\n    border-left: 1px solid #12344D;\n    height: 16px;\n    margin-left: 8px;\n    margin-right: 8px;\n    color: #12344D;\n    opacity: 0.6;\n"]);return S=function(){return e},e}function _(){var e=Object(d.a)(["\n    opacity: 0.6;\t\n    color: #12344D;\t\n    font-size: 14px;\t\n    line-height: 16px;\t\n    text-align: center;\n\n"]);return _=function(){return e},e}function B(){var e=Object(d.a)(["\n    margin: 8px;\n    width: calc(100vw - 38px);\n    padding-left: 20px;\n    background: #FFF;\n    box-shadow: 0 2px 18px 0 rgba(18,52,77,0.16);\n    border: 1px solid #EBEEF0;\n    height: 200px;\n    overflow: scroll;\n    position: absolute;\n    bottom: 0;\n    border-radius: 4px;\n"]);return B=function(){return e},e}function T(){var e=Object(d.a)(["\n    margin-right: 10px;\n    height: 12px;\n    width: 12px;\n"]);return T=function(){return e},e}function N(){var e=Object(d.a)(["\n    position: absolute;\n    top: 60px;\n    right: 36px;\n    font-size: 14px;\n    color: #12344D;\n"]);return N=function(){return e},e}function L(){var e=Object(d.a)(["\n\n"]);return L=function(){return e},e}function z(){var e=Object(d.a)(["\n    line-height: 20px;\n    align-items: center;\n    margin-top: 2px;\n"]);return z=function(){return e},e}function P(){var e=Object(d.a)(["\n    .ReactCrop__image {\n        height: auto !important;\n    }\n"]);return P=function(){return e},e}function I(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function M(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?I(Object(n),!0).forEach((function(t){Object(h.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):I(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var q=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).clearCroparea=function(){n.setState({crop:{x:10,y:10,width:0,height:0},selectedBlock:null,showAssetDetails:!1,allAssets:[],showAllAssets:!1,showAllTickets:!1})},n.onImageLoaded=function(e){},n.onCropComplete=function(e){},n.onCropChange=function(e){e.y=document.getElementsByClassName("ReactCrop")[0].scrollTop+e.y,n.state.allowEdit&&n.setState({crop:e})},n.createBlock=function(){var e=n.state,t=(e.selectedBlock,e.blocks),a=Object(k.cloneDeep)(t),o=n.state.crop;a.push(o),n.setState({blocks:a})},n.deleteBlock=function(e){var t=n.state,a=t.selectedBlock,o=t.blocks;if(a>=0){var s=Object(k.cloneDeep)(o);s.splice(a,1),n.setState({blocks:s})}},n.renderBlocks=function(){var e=n.props.params.context,t=n.state,a=(t.selectedBlock,t.blocks),s=t.allTickets,r="hawk_eye"===e.data.page,i={};return a.map((function(e,t){var a=e.color,c={};return r&&s.length&&(c=s.find((function(t){for(var n in t.asset)if(t.asset[n].id===e.associations.display_id)return!0})))&&Object.keys(c).length&&(a=n.styleMap[c.ticket.priority_name.toLowerCase()]),"string"===typeof e.color&&e.color.length?a=e.color:(i=a||{},a=""),o.a.createElement(ne,{item:e,style:i,isSelected:t==n.state.selectedBlock,color:a,onClick:function(){n.setState({selectedBlock:t}),n.viewAssetDetails(t)}})}))},n.saveMappings=function(){for(var e=n.state.blocks,t=n.props.params.client,a=(e.filter((function(e){return e.associations})).map((function(e){return Object(h.a)({},e.associations.display_id,e)})),{}),o=0;o<e.length;o++)e[o].associations&&(a[e[o].associations.display_id]=e[o]);Object.keys(a).length?t.db.set("asset_mappings",a).then((function(e){t.interface.trigger("showNotify",{type:"success",message:"Pulished successfully"}).then((function(e){})).catch((function(e){}))})):t.db.delete("asset_mappings").then((function(e){t.interface.trigger("showNotify",{type:"success",message:"All asset mappings removed successfully"}).then((function(e){})).catch((function(e){}))}))},n.showAssetDetails=function(){var e=n.state,t=e.selectedBlock,a=e.blocks;if(e.showAssetDetails&&a[t]&&a[t].associations){var s=a[t].associations;return o.a.createElement($,null,o.a.createElement(ee,null,s.name),o.a.createElement("div",{className:"flex row center mt8"},o.a.createElement(G,null,s.ci_type_name),o.a.createElement(Q,null),o.a.createElement(G,null,"Business Impact : ",s.business_impact)),o.a.createElement("div",{className:"flex col start mt26 half-width"},o.a.createElement("div",{className:"flex row start full-width"},o.a.createElement(U,{className:"half-width"},"Name"),o.a.createElement(V,null,s.name)),o.a.createElement("div",{className:"flex row start mt8 full-width"},o.a.createElement(U,{className:"half-width"},"Type"),o.a.createElement(V,null,s.ci_type_name)),o.a.createElement("div",{className:"flex row start mt8 full-width"},o.a.createElement(U,{className:"half-width"},"Impact"),o.a.createElement(V,null,s.business_impact))))}return""},n.getAllTickets=function(){var e=n.props.params.client;e.request.get("https://<%=iparam.freshservice_subdomain%>.freshservice.com/helpdesk/tickets/filter/all_tickets?format=json&page=1",{headers:{Authorization:"Basic <%= encode(iparam.freshservice_api_key)%>","Content-Type":"application/json;charset=utf-8"}}).then(function(t){var n=this,a=JSON.parse(t.response),o=[],s=0;a.forEach((function(t,a){s+=1,e.db.get("ticket".concat(t.display_id)).then(function(e){o.push({ticket:t,asset:e}),a==s-1&&this.setState({allTickets:o})}.bind(n)).catch(function(e){a==s-1&&(o.push({ticket:t,asset:{}}),this.setState({allTickets:o}))}.bind(n))}))}.bind(Object(f.a)(n))).catch((function(e){console.error(e)}))},n.mapAssetDetails=function(){n.props.params.client.request.get("https://<%=iparam.freshservice_subdomain%>.freshservice.com/cmdb/items.json",{headers:{Authorization:"Basic <%= encode(iparam.freshservice_api_key)%>","Content-Type":"application/json;charset=utf-8"}}).then(function(e){this.setState({allAssets:JSON.parse(e.response),showAllAssets:!0})}.bind(Object(f.a)(n))).catch((function(e){console.error(e)}))},n.viewAssetDetails=function(e){n.state.blocks[e].associations?n.setState({showAssetDetails:!0}):n.mapAssetDetails()},n.mapcurrentAsset=function(e){var t=n.state,a=t.selectedBlock,o=t.blocks,s=Object(k.cloneDeep)(o),r=M({},s[a],{associations:e});s[a]=r,n.setState({blocks:s}),n.setState({showAllAssets:!1}),n.setState({showAssetDetails:!0})},n.showSelectedAsset=function(e){var t=n.state,a=(t.selectedBlock,t.blocks.map((function(t){var n=[];for(var a in e.asset)n.push(e.asset[a].id);return M({},t,{color:n.indexOf(t.associations.display_id)>-1?"#12344D":""})})));n.setState({blocks:a})},n.showAllAssets=function(){var e=n.state.allAssets;return o.a.createElement(X,null,o.a.createElement(te,{noHover:!0},o.a.createElement(Z,null,"Asset Name"),o.a.createElement(Z,null,"Asset Type"),o.a.createElement(Z,null,"Business Impact")),e.map((function(e){return o.a.createElement(te,{onClick:function(){n.mapcurrentAsset(e)}},o.a.createElement(Y,null,e.name),o.a.createElement(Y,null,e.ci_type_name),o.a.createElement(Y,null,e.business_impact))})))},n.showAllTickets=function(){var e=n.state.allTickets;return o.a.createElement(X,null,o.a.createElement(te,{noHover:!0},o.a.createElement(Z,null,"Ticket Subject"),o.a.createElement(Z,null,"Requester"),o.a.createElement(Z,null,"Status")),e.map((function(e){return o.a.createElement(te,{onClick:function(){n.showSelectedAsset(e)}},o.a.createElement(Y,{style:{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"},title:e.ticket.subject},e.ticket.subject),o.a.createElement(Y,null,e.ticket.requester_name),o.a.createElement(Y,null,e.ticket.status_name))})))},n.toogleTicketOverLay=function(){var e=n.state.showAllTickets;n.setState({showAllTickets:!e})},n.renderLegends=function(){var e=Object.keys(n.styleMap);return o.a.createElement(K,null,e.map((function(e){return o.a.createElement(J,{className:"flex"},o.a.createElement(W,{style:n.styleMap[e]}),o.a.createElement(R,null,e))})),o.a.createElement(J,{className:"flex"},o.a.createElement(W,{style:{backgroundColor:"#90C6FE"}}),o.a.createElement(R,null,"not associated")))},n.state={crop:{x:10,y:10,width:0,height:0},selectedBlock:null,blocks:[],showAllAssets:!1,showAssetDetails:!1,allAssets:[],allTickets:[],showAllTickets:!1,allowEdit:!1},n.styleMap={low:{backgroundColor:"#1CB697",boxShadow:"0 2px 4px 0 #00B797, 0 2px 10px 0 #00B897"},medium:{backgroundColor:"#459FFC",boxShadow:"0 2px 4px 0 #459FFC, 0 2px 10px 0 #459FFC"},high:{backgroundColor:"#F69A3C",boxShadow:"0 2px 4px 0 #F89B2D, 0 2px 10px 0 #F89B2D"},urgent:{backgroundColor:"#FF5959",boxShadow:"0 2px 4px 0 #FF5959, 0 2px 10px 0 #FF5959"}},n}return Object(p.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.params,t=e.context,n=e.client;n&&n.db&&n.db.get("asset_mappings").then(function(e){if(e&&"hawk_eye"==t.data.page){this.getAllTickets();var n=[];for(var a in e)n.push(e[a]);this.setState({blocks:n})}else e&&Object.keys(e).indexOf(t.data.assetId.toString())>-1&&this.setState({blocks:[e[t.data.assetId]]})}.bind(this)),t&&t.data&&"ticket"!==t.data.page&&this.setState({allowEdit:!0}),document.addEventListener("keydown",this.handleKeyDown.bind(this))}},{key:"handleKeyDown",value:function(e){if("hawk_eye"!==this.props.params.context.data.page)switch(e.keyCode){case 13:this.createBlock();break;case 8:this.deleteBlock()}this.clearCroparea()}},{key:"render",value:function(){var e=this,t=this.state,n=t.showAssetDetails,a=t.showAllAssets,s=t.allowEdit,r=t.showAllTickets,i=this.props.params.context;return o.a.createElement(H,null,o.a.createElement(v.a,{src:b.a,crop:this.state.crop,onImageLoaded:this.onImageLoaded,onComplete:this.onCropComplete,onChange:this.onCropChange},this.renderBlocks()),n&&this.showAssetDetails(),a&&this.showAllAssets(),r&&this.showAllTickets(),"hawk_eye"==i.data.page?o.a.createElement(ae,{secondary:!0,onClick:function(){return e.toogleTicketOverLay()}},r?"Hide list":"Show list"):s&&o.a.createElement(ae,{onClick:function(){return e.saveMappings()}},"Publish"),"hawk_eye"==i.data.page&&this.renderLegends())}}]),t}(a.Component),H=x.a.div(P()),J=x.a.div(z()),R=x.a.div(L()),K=x.a.div(N()),W=x.a.div(T()),$=x.a.div(B()),G=x.a.div(_()),Q=x.a.div(S()),U=x.a.div(D()),V=x.a.div(F()),X=x.a.div(C()),Y=x.a.div(A()),Z=x.a.div(j()),ee=x.a.div(O()),te=x.a.div(E(),(function(e){return!e.noHover&&"\n        &:hover{\n            background-color: #EBEFF3;\n        }\n    "})),ne=x.a.div(y(),(function(e){return"translate3d(".concat(e.item.x,"px,").concat(e.item.y,"px,0)")}),(function(e){return e.color?e.color:"#90C6FE"}),(function(e){return e.isSelected?"2px solid #2C5CC5":"2px solid transparent"}),(function(e){return e.item.width}),(function(e){return e.item.height})),ae=x.a.button(w(),(function(e){return e.secondary?"#F3F5F7":"#009A79"}),(function(e){return e.secondary?"#12344D":"#FFF"}),(function(e){return e.secondary?"1px solid #dadfe3":"1px solid green"})),oe=q,se=(n(43),function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).initialiseApp=function(){window.app.initialized().then((function(e){var t=e;n.setState({client:t}),t.instance.context().then((function(e){n.setState({context:e,clientLoaded:!0})})).catch((function(e){}))}))},n.state={context:{},client:{},clientLoaded:!1},n}return Object(p.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){document.addEventListener("DOMContentLoaded",this.initialiseApp)}},{key:"render",value:function(){var e=this.state,t={context:e.context,client:e.client};return e.clientLoaded?o.a.createElement(oe,{params:t}):""}}]),t}(o.a.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(o.a.createElement(se,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[24,1,2]]]);
//# sourceMappingURL=main.dac27067.chunk.js.map